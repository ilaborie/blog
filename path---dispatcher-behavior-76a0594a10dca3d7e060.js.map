{"version":3,"sources":["webpack:///path---dispatcher-behavior-76a0594a10dca3d7e060.js","webpack:///./.cache/json/dispatcher-behavior.json"],"names":["webpackJsonp","427","module","exports","data","site","siteMetadata","title","author","markdownRemark","id","html","frontmatter","date","pathContext","slug"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,MAAQC,cAAgBC,MAAA,0BAAAC,OAAA,mBAA6DC,gBAAmBC,GAAA,wGAAAC,KAAA,03kBAAsmmBC,aAAmDL,MAAA,sBAAAM,KAAA,uBAA2DC,aAAgBC,KAAA","file":"path---dispatcher-behavior-76a0594a10dca3d7e060.js","sourcesContent":["webpackJsonp([235964179464078],{\n\n/***/ 427:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Akka, Concurrency, etc.\",\"author\":\"Richard Imaoka\"}},\"markdownRemark\":{\"id\":\"C:/Users/richardimaoka/blog/src/pages/dispatcher-behavior/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<h2>Overview</h2>\\n<div>\\n          <div\\n            class=\\\"gatsby-resp-iframe-wrapper\\\"\\n            style=\\\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem\\\"\\n          >\\n            <iframe src=\\\"https://www.youtube.com/embed/0tDFep0hOSI\\\" frameborder=\\\"0\\\" allow=\\\"autoplay; encrypted-media\\\" allowfullscreen style=\\\"\\n            position: absolute;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n          \\\"></iframe>\\n          </div>\\n          </div>\\n<p>The concept of Akka <a href=\\\"https://doc.akka.io/docs/akka/2.5/dispatchers.html?language=scala\\\"><code class=\\\"language-text\\\">Dispatcher</code></a> might be unfamiliar to you and it is probably difficult to understand. So I am going to explain how Dispatcher works in detail here.</p>\\n<h2>Meaning of “dispatch”</h2>\\n<p>If you look up the meaning of the word “dispatch” in a dictionary, you would find it is almost same as “send”. In akka, <code class=\\\"language-text\\\">Dispatcher</code> is, yes, what sends messages, but something more than that.</p>\\n<h2>Dispatcher and Actor relationship</h2>\\n<p><img src=\\\"/blog/dispatcher-config-71bb79f013295f371bbb154394bc0b8e.jpg\\\" alt=\\\"dispatcher-config\\\"></p>\\n<p>Firstly, <code class=\\\"language-text\\\">Dispatcher</code> is configured for <code class=\\\"language-text\\\">ActorSystem</code>, typically in <code class=\\\"language-text\\\">application.conf</code>. There is at least default one, and you can <a href=\\\"https://doc.akka.io/docs/akka/current/dispatchers.html#dispatchers\\\">also configure multiple <code class=\\\"language-text\\\">Dispatcher</code>s</a>.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">val</span> system <span class=\\\"token operator\\\">=</span> ActorSystem<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"exampleSystem\\\"</span><span class=\\\"token punctuation\\\">)</span>\\nsystem<span class=\\\"token punctuation\\\">.</span>dispatchers<span class=\\\"token punctuation\\\">.</span>lookup<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"my-dispatcher\\\"</span><span class=\\\"token punctuation\\\">)</span></code></pre>\\n      </div>\\n<p>As a rule of thumb, the <code class=\\\"language-text\\\">Dispatcher</code> instance for the given name is created when the <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatchers.scala#L79\\\"><code class=\\\"language-text\\\">lookup</code> method of <code class=\\\"language-text\\\">ActorSystem</code></a> is called for the first time. You don’t normally call it yourself, but this lookup is done by akka. Another thing is the default <code class=\\\"language-text\\\">Dispatcher</code> is already created upon <code class=\\\"language-text\\\">ActorSystem</code> initialization, as it calls <code class=\\\"language-text\\\">lookup</code> for the default internally.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token comment\\\">/**\\n* Returns a dispatcher as specified in configuration. Please note that this\\n* method _may_ create and return a NEW dispatcher, _every_ call.\\n*\\n* Throws ConfigurationException if the specified dispatcher cannot be found in the configuration.\\n*/</span>\\n<span class=\\\"token keyword\\\">def</span> lookup<span class=\\\"token punctuation\\\">(</span>id<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">String</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> MessageDispatcher <span class=\\\"token operator\\\">=</span> lookupConfigurator<span class=\\\"token punctuation\\\">(</span>id<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>dispatcher<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span></code></pre>\\n      </div>\\n<p><img src=\\\"/blog/dispatcher-actor-7b6a80fb086b1889109bdb71e0f6f72f.jpg\\\" alt=\\\"dispatcher-actor\\\"></p>\\n<p><code class=\\\"language-text\\\">Dispatcher</code> is NOT part of <code class=\\\"language-text\\\">Actor</code>. One <code class=\\\"language-text\\\">Dispatcher</code> can send messages to multiple <code class=\\\"language-text\\\">Actor</code>s. (NOTE: <code class=\\\"language-text\\\">Dispatcher</code> doesn’t have routing capabilities. Routing is done by akka <a href=\\\"https://doc.akka.io/docs/akka/2.5/routing.html#routing\\\"><code class=\\\"language-text\\\">Router</code></a>)</p>\\n<h2>Dispatcher and ExecutorService</h2>\\n<p><img src=\\\"/blog/dispatcher-executor-service-35308dce71584aa4d7cdfad5c6d455dd.jpg\\\" alt=\\\"dispatcher-executor-service\\\"></p>\\n<p><code class=\\\"language-text\\\">Dispatcher</code> has <code class=\\\"language-text\\\">ExecutorService</code>, and <code class=\\\"language-text\\\">ExecutorService</code> is like a pool of threads where you can execute code (<code class=\\\"language-text\\\">Runnable</code>) concurrently. See <a href=\\\"../executor-and-execution-context\\\">Executor/ExecutorService in Java, and ExecutionContext behind Future in Scala</a> for illustration and more details.</p>\\n<p>Here is <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatcher.scala#L47\\\"><code class=\\\"language-text\\\">executorService</code> method</a> of <code class=\\\"language-text\\\">Dispatcher</code>.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">def</span> executorService<span class=\\\"token operator\\\">:</span> ExecutorServiceDelegate <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span></code></pre>\\n      </div>\\n<p>The pool of threads from <code class=\\\"language-text\\\">ExecutorService</code> is what invokes <code class=\\\"language-text\\\">Actor</code>’s <code class=\\\"language-text\\\">receive</code> method, which will be explained later in this article.</p>\\n<h2>Dispatcher and sender-side behavior</h2>\\n<p><img src=\\\"/blog/actor-cell-reference-6638f57fa06f7a2f08d0bd841a7eb514.jpg\\\" alt=\\\"actor-cell-reference\\\"></p>\\n<p>Part of below is reharsing what was already discussed in <a href=\\\"../local-minimal-sender\\\">Local Actor workflow part 1 - Sender side</a>, but here more from the <code class=\\\"language-text\\\">Dispatcher</code> perspective. </p>\\n<p>(For remoting, there are several more steps to go through but it is combination of local message-passing and network via Netty, as discussed in <a href=\\\"../remote-minimal-sender\\\">remoting articles</a>)</p>\\n<p><code class=\\\"language-text\\\">LocalActorRef</code> is <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/actor/ActorRef.scala#L319\\\">coupled with <code class=\\\"language-text\\\">ActorCell</code></a>, which is hidden from users as private and it is implementation details of how akka messaging works.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">class</span> LocalActorRef<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">)</span>\\n <span class=\\\"token keyword\\\">extends</span> ActorRefWithCell\\n <span class=\\\"token keyword\\\">with</span> LocalRef  <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token keyword\\\">val</span> actorCell<span class=\\\"token operator\\\">:</span> ActorCell <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p><a href=\\\"\\\">As you see below</a>, <code class=\\\"language-text\\\">ActorCell</code> has a reference to <code class=\\\"language-text\\\">Dispatcher</code> (<code class=\\\"language-text\\\">val dispatcher:  MessageDispatcher</code>).</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">class</span> ActorCell<span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token keyword\\\">val</span> dispatcher<span class=\\\"token operator\\\">:</span>  MessageDispatcher<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">extends</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token keyword\\\">with</span> dungeon<span class=\\\"token punctuation\\\">.</span>Dispatch <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>So when you do <code class=\\\"language-text\\\">actorRef ! &quot;hello&quot;</code>, that <code class=\\\"language-text\\\">actorRef</code> (whose type is <code class=\\\"language-text\\\">LocalActorRef</code>) already knows what <code class=\\\"language-text\\\">Dispatcher</code> to use via <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/actor/ActorCell.scala#L370\\\"><code class=\\\"language-text\\\">ActorCell</code></a>.</p>\\n<p>Also <code class=\\\"language-text\\\">ActorCell</code> extends <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/actor/dungeon/Dispatch.scala#L27\\\"><code class=\\\"language-text\\\">Dispatch</code> trait</a> and it has a refence to <code class=\\\"language-text\\\">Mailbox</code>, so <code class=\\\"language-text\\\">LocalActorRef</code> also knows which <code class=\\\"language-text\\\">Mailbox</code> to send the massage, via <code class=\\\"language-text\\\">ActorCell</code>. </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">trait</span> Dispatch <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token operator\\\">:</span> ActorCell ⇒\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token keyword\\\">def</span> mailbox<span class=\\\"token operator\\\">:</span> Mailbox <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>This couping of <code class=\\\"language-text\\\">LocalActorRef</code>, <code class=\\\"language-text\\\">ActorCell</code>, and <code class=\\\"language-text\\\">Mailbox</code> is what I meant by <code class=\\\"language-text\\\">Dispatcher</code> doesn’t have routing capabilities in a “NOTE” earlier.</p>\\n<p><img src=\\\"/blog/sender-82d6c008ac87adf2e72a0389eab07010.jpg\\\" alt=\\\"sender\\\"></p>\\n<p><code class=\\\"language-text\\\">Dispatcher</code>’s <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatcher.scala#L52L56\\\">dispatch</a> method is as follows:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">def</span> dispatch<span class=\\\"token punctuation\\\">(</span>\\n  receiver<span class=\\\"token operator\\\">:</span> ActorCell<span class=\\\"token punctuation\\\">,</span>\\n  invocation<span class=\\\"token operator\\\">:</span> Envelope\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">Unit</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">val</span> mbox <span class=\\\"token operator\\\">=</span> receiver<span class=\\\"token punctuation\\\">.</span>mailbox\\n  mbox<span class=\\\"token punctuation\\\">.</span>enqueue<span class=\\\"token punctuation\\\">(</span>receiver<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">,</span> invocation<span class=\\\"token punctuation\\\">)</span>\\n  registerForExecution<span class=\\\"token punctuation\\\">(</span>mbox<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>where <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatcher.scala#L115\\\">registerForExecution</a> is:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">def</span> registerForExecution<span class=\\\"token punctuation\\\">(</span>mbox<span class=\\\"token operator\\\">:</span> Mailbox<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">Boolean</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  executorService execute mbox\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>In the above code, <code class=\\\"language-text\\\">Dispatcher</code>’s <code class=\\\"language-text\\\">excutorService</code> is executing <code class=\\\"language-text\\\">mbox: Mailbox</code>, because <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Mailbox.scala#L56L57\\\"><code class=\\\"language-text\\\">Mailbox</code></a> extends <code class=\\\"language-text\\\">ForkJoinTask</code>, which can be <code class=\\\"language-text\\\">execute</code>-d by <code class=\\\"language-text\\\">ExecutorService</code>.</p>\\n<p><img src=\\\"/blog/fork-join-1-a6354b55480d0404f2a1e8cc8cf61656.jpg\\\" alt=\\\"fork-join-1\\\"></p>\\n<p><img src=\\\"/blog/fork-join-2-05d3f1320821da8a2108754cfb8375e2.jpg\\\" alt=\\\"fork-join-2\\\"></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">abstract</span> <span class=\\\"token keyword\\\">class</span> Mailbox<span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">val</span> messageQueue<span class=\\\"token operator\\\">:</span> MessageQueue<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">extends</span> ForkJoinTask<span class=\\\"token punctuation\\\">[</span><span class=\\\"token builtin\\\">Unit</span><span class=\\\"token punctuation\\\">]</span> \\n  <span class=\\\"token keyword\\\">with</span> SystemMessageQueue \\n  <span class=\\\"token keyword\\\">with</span> Runnable <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>Execution (i.e. processing) of <code class=\\\"language-text\\\">Mailbox</code> is run on a different <code class=\\\"language-text\\\">Thread</code>, which was covered in <a href=\\\"../local-minimal-receiver\\\">Local Actor workflow part 2 - Receiver side</a></p>\\n<h2>Dispatcher and receiver-side behavior</h2>\\n<p><img src=\\\"/blog/fork-join-3-b8aff16a96f1775898c83f3ca43c0658.jpg\\\" alt=\\\"fork-join-3\\\"></p>\\n<p>When <code class=\\\"language-text\\\">run</code> method of <code class=\\\"language-text\\\">ForkJoinTask</code> is executed, the <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Mailbox.scala#L250\\\">following method of <code class=\\\"language-text\\\">Mailbox</code></a> is called, </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token annotation punctuation\\\">@tailrec</span> <span class=\\\"token keyword\\\">private</span> <span class=\\\"token keyword\\\">final</span> <span class=\\\"token keyword\\\">def</span> processMailbox<span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token comment\\\">// def dequeue(): Envelope = messageQueue.dequeue()</span>\\n  <span class=\\\"token keyword\\\">val</span> next <span class=\\\"token operator\\\">=</span> dequeue<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> \\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  actor invoke next\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  processMailbox<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>it picks up a message from the message queue, and process it.</p>\\n<p><img src=\\\"/blog/receiver-80a6300d25cf7552f05cceef167e99a5.jpg\\\" alt=\\\"receiver\\\"></p>\\n<p>So this <code class=\\\"language-text\\\">processMailbox</code> method, called from <code class=\\\"language-text\\\">ForkJoinTask</code>’s <code class=\\\"language-text\\\">run</code> is what invokes your <code class=\\\"language-text\\\">receive</code> method you defined in your <code class=\\\"language-text\\\">Actor</code>.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">class</span> MyActor <span class=\\\"token keyword\\\">extends</span> Actor <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">def</span> receive <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>  \\n  <span class=\\\"token punctuation\\\">}</span>  \\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\",\"frontmatter\":{\"title\":\"Dispatcher behavior\",\"date\":\"February 12, 2018\"}}},\"pathContext\":{\"slug\":\"/dispatcher-behavior/\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---dispatcher-behavior-76a0594a10dca3d7e060.js","module.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Akka, Concurrency, etc.\",\"author\":\"Richard Imaoka\"}},\"markdownRemark\":{\"id\":\"C:/Users/richardimaoka/blog/src/pages/dispatcher-behavior/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<h2>Overview</h2>\\n<div>\\n          <div\\n            class=\\\"gatsby-resp-iframe-wrapper\\\"\\n            style=\\\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem\\\"\\n          >\\n            <iframe src=\\\"https://www.youtube.com/embed/0tDFep0hOSI\\\" frameborder=\\\"0\\\" allow=\\\"autoplay; encrypted-media\\\" allowfullscreen style=\\\"\\n            position: absolute;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n          \\\"></iframe>\\n          </div>\\n          </div>\\n<p>The concept of Akka <a href=\\\"https://doc.akka.io/docs/akka/2.5/dispatchers.html?language=scala\\\"><code class=\\\"language-text\\\">Dispatcher</code></a> might be unfamiliar to you and it is probably difficult to understand. So I am going to explain how Dispatcher works in detail here.</p>\\n<h2>Meaning of “dispatch”</h2>\\n<p>If you look up the meaning of the word “dispatch” in a dictionary, you would find it is almost same as “send”. In akka, <code class=\\\"language-text\\\">Dispatcher</code> is, yes, what sends messages, but something more than that.</p>\\n<h2>Dispatcher and Actor relationship</h2>\\n<p><img src=\\\"/blog/dispatcher-config-71bb79f013295f371bbb154394bc0b8e.jpg\\\" alt=\\\"dispatcher-config\\\"></p>\\n<p>Firstly, <code class=\\\"language-text\\\">Dispatcher</code> is configured for <code class=\\\"language-text\\\">ActorSystem</code>, typically in <code class=\\\"language-text\\\">application.conf</code>. There is at least default one, and you can <a href=\\\"https://doc.akka.io/docs/akka/current/dispatchers.html#dispatchers\\\">also configure multiple <code class=\\\"language-text\\\">Dispatcher</code>s</a>.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">val</span> system <span class=\\\"token operator\\\">=</span> ActorSystem<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"exampleSystem\\\"</span><span class=\\\"token punctuation\\\">)</span>\\nsystem<span class=\\\"token punctuation\\\">.</span>dispatchers<span class=\\\"token punctuation\\\">.</span>lookup<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"my-dispatcher\\\"</span><span class=\\\"token punctuation\\\">)</span></code></pre>\\n      </div>\\n<p>As a rule of thumb, the <code class=\\\"language-text\\\">Dispatcher</code> instance for the given name is created when the <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatchers.scala#L79\\\"><code class=\\\"language-text\\\">lookup</code> method of <code class=\\\"language-text\\\">ActorSystem</code></a> is called for the first time. You don’t normally call it yourself, but this lookup is done by akka. Another thing is the default <code class=\\\"language-text\\\">Dispatcher</code> is already created upon <code class=\\\"language-text\\\">ActorSystem</code> initialization, as it calls <code class=\\\"language-text\\\">lookup</code> for the default internally.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token comment\\\">/**\\n* Returns a dispatcher as specified in configuration. Please note that this\\n* method _may_ create and return a NEW dispatcher, _every_ call.\\n*\\n* Throws ConfigurationException if the specified dispatcher cannot be found in the configuration.\\n*/</span>\\n<span class=\\\"token keyword\\\">def</span> lookup<span class=\\\"token punctuation\\\">(</span>id<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">String</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> MessageDispatcher <span class=\\\"token operator\\\">=</span> lookupConfigurator<span class=\\\"token punctuation\\\">(</span>id<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>dispatcher<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span></code></pre>\\n      </div>\\n<p><img src=\\\"/blog/dispatcher-actor-7b6a80fb086b1889109bdb71e0f6f72f.jpg\\\" alt=\\\"dispatcher-actor\\\"></p>\\n<p><code class=\\\"language-text\\\">Dispatcher</code> is NOT part of <code class=\\\"language-text\\\">Actor</code>. One <code class=\\\"language-text\\\">Dispatcher</code> can send messages to multiple <code class=\\\"language-text\\\">Actor</code>s. (NOTE: <code class=\\\"language-text\\\">Dispatcher</code> doesn’t have routing capabilities. Routing is done by akka <a href=\\\"https://doc.akka.io/docs/akka/2.5/routing.html#routing\\\"><code class=\\\"language-text\\\">Router</code></a>)</p>\\n<h2>Dispatcher and ExecutorService</h2>\\n<p><img src=\\\"/blog/dispatcher-executor-service-35308dce71584aa4d7cdfad5c6d455dd.jpg\\\" alt=\\\"dispatcher-executor-service\\\"></p>\\n<p><code class=\\\"language-text\\\">Dispatcher</code> has <code class=\\\"language-text\\\">ExecutorService</code>, and <code class=\\\"language-text\\\">ExecutorService</code> is like a pool of threads where you can execute code (<code class=\\\"language-text\\\">Runnable</code>) concurrently. See <a href=\\\"../executor-and-execution-context\\\">Executor/ExecutorService in Java, and ExecutionContext behind Future in Scala</a> for illustration and more details.</p>\\n<p>Here is <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatcher.scala#L47\\\"><code class=\\\"language-text\\\">executorService</code> method</a> of <code class=\\\"language-text\\\">Dispatcher</code>.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">def</span> executorService<span class=\\\"token operator\\\">:</span> ExecutorServiceDelegate <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span></code></pre>\\n      </div>\\n<p>The pool of threads from <code class=\\\"language-text\\\">ExecutorService</code> is what invokes <code class=\\\"language-text\\\">Actor</code>’s <code class=\\\"language-text\\\">receive</code> method, which will be explained later in this article.</p>\\n<h2>Dispatcher and sender-side behavior</h2>\\n<p><img src=\\\"/blog/actor-cell-reference-6638f57fa06f7a2f08d0bd841a7eb514.jpg\\\" alt=\\\"actor-cell-reference\\\"></p>\\n<p>Part of below is reharsing what was already discussed in <a href=\\\"../local-minimal-sender\\\">Local Actor workflow part 1 - Sender side</a>, but here more from the <code class=\\\"language-text\\\">Dispatcher</code> perspective. </p>\\n<p>(For remoting, there are several more steps to go through but it is combination of local message-passing and network via Netty, as discussed in <a href=\\\"../remote-minimal-sender\\\">remoting articles</a>)</p>\\n<p><code class=\\\"language-text\\\">LocalActorRef</code> is <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/actor/ActorRef.scala#L319\\\">coupled with <code class=\\\"language-text\\\">ActorCell</code></a>, which is hidden from users as private and it is implementation details of how akka messaging works.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">class</span> LocalActorRef<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">)</span>\\n <span class=\\\"token keyword\\\">extends</span> ActorRefWithCell\\n <span class=\\\"token keyword\\\">with</span> LocalRef  <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token keyword\\\">val</span> actorCell<span class=\\\"token operator\\\">:</span> ActorCell <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p><a href=\\\"\\\">As you see below</a>, <code class=\\\"language-text\\\">ActorCell</code> has a reference to <code class=\\\"language-text\\\">Dispatcher</code> (<code class=\\\"language-text\\\">val dispatcher:  MessageDispatcher</code>).</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">class</span> ActorCell<span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token keyword\\\">val</span> dispatcher<span class=\\\"token operator\\\">:</span>  MessageDispatcher<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">extends</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token keyword\\\">with</span> dungeon<span class=\\\"token punctuation\\\">.</span>Dispatch <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>So when you do <code class=\\\"language-text\\\">actorRef ! &quot;hello&quot;</code>, that <code class=\\\"language-text\\\">actorRef</code> (whose type is <code class=\\\"language-text\\\">LocalActorRef</code>) already knows what <code class=\\\"language-text\\\">Dispatcher</code> to use via <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/actor/ActorCell.scala#L370\\\"><code class=\\\"language-text\\\">ActorCell</code></a>.</p>\\n<p>Also <code class=\\\"language-text\\\">ActorCell</code> extends <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/actor/dungeon/Dispatch.scala#L27\\\"><code class=\\\"language-text\\\">Dispatch</code> trait</a> and it has a refence to <code class=\\\"language-text\\\">Mailbox</code>, so <code class=\\\"language-text\\\">LocalActorRef</code> also knows which <code class=\\\"language-text\\\">Mailbox</code> to send the massage, via <code class=\\\"language-text\\\">ActorCell</code>. </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">trait</span> Dispatch <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token operator\\\">:</span> ActorCell ⇒\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token keyword\\\">def</span> mailbox<span class=\\\"token operator\\\">:</span> Mailbox <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>This couping of <code class=\\\"language-text\\\">LocalActorRef</code>, <code class=\\\"language-text\\\">ActorCell</code>, and <code class=\\\"language-text\\\">Mailbox</code> is what I meant by <code class=\\\"language-text\\\">Dispatcher</code> doesn’t have routing capabilities in a “NOTE” earlier.</p>\\n<p><img src=\\\"/blog/sender-82d6c008ac87adf2e72a0389eab07010.jpg\\\" alt=\\\"sender\\\"></p>\\n<p><code class=\\\"language-text\\\">Dispatcher</code>’s <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatcher.scala#L52L56\\\">dispatch</a> method is as follows:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">def</span> dispatch<span class=\\\"token punctuation\\\">(</span>\\n  receiver<span class=\\\"token operator\\\">:</span> ActorCell<span class=\\\"token punctuation\\\">,</span>\\n  invocation<span class=\\\"token operator\\\">:</span> Envelope\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">Unit</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">val</span> mbox <span class=\\\"token operator\\\">=</span> receiver<span class=\\\"token punctuation\\\">.</span>mailbox\\n  mbox<span class=\\\"token punctuation\\\">.</span>enqueue<span class=\\\"token punctuation\\\">(</span>receiver<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">,</span> invocation<span class=\\\"token punctuation\\\">)</span>\\n  registerForExecution<span class=\\\"token punctuation\\\">(</span>mbox<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>where <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatcher.scala#L115\\\">registerForExecution</a> is:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">def</span> registerForExecution<span class=\\\"token punctuation\\\">(</span>mbox<span class=\\\"token operator\\\">:</span> Mailbox<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">Boolean</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  executorService execute mbox\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>In the above code, <code class=\\\"language-text\\\">Dispatcher</code>’s <code class=\\\"language-text\\\">excutorService</code> is executing <code class=\\\"language-text\\\">mbox: Mailbox</code>, because <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Mailbox.scala#L56L57\\\"><code class=\\\"language-text\\\">Mailbox</code></a> extends <code class=\\\"language-text\\\">ForkJoinTask</code>, which can be <code class=\\\"language-text\\\">execute</code>-d by <code class=\\\"language-text\\\">ExecutorService</code>.</p>\\n<p><img src=\\\"/blog/fork-join-1-a6354b55480d0404f2a1e8cc8cf61656.jpg\\\" alt=\\\"fork-join-1\\\"></p>\\n<p><img src=\\\"/blog/fork-join-2-05d3f1320821da8a2108754cfb8375e2.jpg\\\" alt=\\\"fork-join-2\\\"></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">abstract</span> <span class=\\\"token keyword\\\">class</span> Mailbox<span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">val</span> messageQueue<span class=\\\"token operator\\\">:</span> MessageQueue<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">extends</span> ForkJoinTask<span class=\\\"token punctuation\\\">[</span><span class=\\\"token builtin\\\">Unit</span><span class=\\\"token punctuation\\\">]</span> \\n  <span class=\\\"token keyword\\\">with</span> SystemMessageQueue \\n  <span class=\\\"token keyword\\\">with</span> Runnable <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>Execution (i.e. processing) of <code class=\\\"language-text\\\">Mailbox</code> is run on a different <code class=\\\"language-text\\\">Thread</code>, which was covered in <a href=\\\"../local-minimal-receiver\\\">Local Actor workflow part 2 - Receiver side</a></p>\\n<h2>Dispatcher and receiver-side behavior</h2>\\n<p><img src=\\\"/blog/fork-join-3-b8aff16a96f1775898c83f3ca43c0658.jpg\\\" alt=\\\"fork-join-3\\\"></p>\\n<p>When <code class=\\\"language-text\\\">run</code> method of <code class=\\\"language-text\\\">ForkJoinTask</code> is executed, the <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Mailbox.scala#L250\\\">following method of <code class=\\\"language-text\\\">Mailbox</code></a> is called, </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token annotation punctuation\\\">@tailrec</span> <span class=\\\"token keyword\\\">private</span> <span class=\\\"token keyword\\\">final</span> <span class=\\\"token keyword\\\">def</span> processMailbox<span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token comment\\\">// def dequeue(): Envelope = messageQueue.dequeue()</span>\\n  <span class=\\\"token keyword\\\">val</span> next <span class=\\\"token operator\\\">=</span> dequeue<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> \\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  actor invoke next\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  processMailbox<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>it picks up a message from the message queue, and process it.</p>\\n<p><img src=\\\"/blog/receiver-80a6300d25cf7552f05cceef167e99a5.jpg\\\" alt=\\\"receiver\\\"></p>\\n<p>So this <code class=\\\"language-text\\\">processMailbox</code> method, called from <code class=\\\"language-text\\\">ForkJoinTask</code>’s <code class=\\\"language-text\\\">run</code> is what invokes your <code class=\\\"language-text\\\">receive</code> method you defined in your <code class=\\\"language-text\\\">Actor</code>.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code class=\\\"language-scala\\\"><span class=\\\"token keyword\\\">class</span> MyActor <span class=\\\"token keyword\\\">extends</span> Actor <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">def</span> receive <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>  \\n  <span class=\\\"token punctuation\\\">}</span>  \\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\",\"frontmatter\":{\"title\":\"Dispatcher behavior\",\"date\":\"February 12, 2018\"}}},\"pathContext\":{\"slug\":\"/dispatcher-behavior/\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/dispatcher-behavior.json\n// module id = 427\n// module chunks = 235964179464078"],"sourceRoot":""}