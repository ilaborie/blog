{"version":3,"sources":["webpack:///path---mailbox-and-fork-join-task-094cf273eb56c5754097.js","webpack:///./.cache/json/mailbox-and-fork-join-task.json"],"names":["webpackJsonp","518","module","exports","data","site","siteMetadata","title","author","markdownRemark","id","html","frontmatter","date","pathContext","slug"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,MAAQC,cAAgBC,MAAA,0BAAAC,OAAA,mBAA6DC,gBAAmBC,GAAA,wGAAAC,KAAA;AAAy08BC,aAAw0XL,MAAA,2BAAAM,KAAA,uBAAgEC,aAAgBC,KAAA","file":"path---mailbox-and-fork-join-task-094cf273eb56c5754097.js","sourcesContent":["webpackJsonp([165329427061039],{\n\n/***/ 518:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Akka, Concurrency, etc.\",\"author\":\"Richard Imaoka\"}},\"markdownRemark\":{\"id\":\"C:/Users/nishyu/blog/src/pages/mailbox-and-fork-join-task/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<h2>Update to the article and the video</h2>\\n<p>Thanks to Victor who immediately noticed I had wrong assumption about <code>ForkJoinTask</code> behavior in akka, now this article and videos were corrected.</p>\\n<blockquote class=\\\"twitter-tweet\\\" data-lang=\\\"ja\\\"><p lang=\\\"en\\\" dir=\\\"ltr\\\">Only one FJT should be created.</p>&mdash; ⎷ (@viktorklang) <a href=\\\"https://twitter.com/viktorklang/status/967066161899819008?ref_src=twsrc%5Etfw\\\">2018年2月23日</a></blockquote>\\n<blockquote class=\\\"twitter-tweet\\\" data-lang=\\\"ja\\\"><p lang=\\\"en\\\" dir=\\\"ltr\\\">No worries! Actually, many years ago it did create many FJT (..or rather, Runnables).</p>&mdash; ⎷ (@viktorklang) <a href=\\\"https://twitter.com/viktorklang/status/967082002804609024?ref_src=twsrc%5Etfw\\\">2018年2月23日</a></blockquote>\\n<h2>Overview</h2>\\n<div>\\n          <div\\n            class=\\\"gatsby-resp-iframe-wrapper\\\"\\n            style=\\\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem\\\"\\n          >\\n            <iframe src=\\\"https://www.youtube.com/embed/dnu6JqtzNJI\\\" frameborder=\\\"0\\\" allow=\\\"autoplay; encrypted-media\\\" allowfullscreen style=\\\"\\n            position: absolute;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n          \\\"></iframe>\\n          </div>\\n          </div>\\n<p>The previous <a href=\\\"../dispatcher-behavior/\\\">Dispatcher behavior</a> article explained how <code>Dispatcher</code> and threads are related to each other. In this article, we will go one step further in this regard.</p>\\n<p>The code example is at <a href=\\\"https://github.com/richardimaoka/resources/tree/master/local-minimal\\\">GitHub</a>, which is the same example as\\nwhat’s discussed in <a href=\\\"http://localhost:8000/local-minimal-sender/\\\">the local actor article(s)</a>.</p>\\n<h2>Thread-processing details in Akka</h2>\\n<p>Following the instruction at the bottom of this article, you will get output as follows <a href=\\\"https://drive.google.com/open?id=194-t1rYNQU2mprybSC9RibJ7HopCAdPqJX94XlIKxXk\\\">(also in GoogleSpreadsheet)</a> . </p>\\n<p><strong>SO MANY things in the table!! but no worries!</strong> We will go through each important piece, one after another.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-1c2a9.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 147.557003257329%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAE5ElEQVQ4y3WV228UZRjGv7/B6AUYL6hXmJgo6rVXYiQx4CF6IRfWdAUF5FQgHBuVghasiKWlgmCIFhQktYJ1Kbb0zG53d/Yw59M38815d/bQlrbQFuM77dKFWr5MJplJJs/7PL/3fQcxpnKNjV6Wor/xtztx2r1TsEq57GTJGc/D/eHLGVv8BvXoqUj3qZ6W9W7Xbnxj91D7llG+ocQfoal+1/Xyvu9Y1szs/X+XOkgruLUms4LtW2GmVtPDnXu/6KlrGPryhEaztm27jmMQwzQs27E9L3v/0YPUvH02fjF0ZevW3rqvb9V1Hl4fa/qYO7OZjw/xvCCLEstxhBDf90dHS4VCoVgsTk5NlZVx3pHDNfFjSG1GpOWZ6/t399fXjTTUS0lKVRVN0xVFIVgjoG5Z8CZfKNybvldW1oruCTr0bhd6P4a29VZd2fLN37Wne/ed50fSGGsmMVRZLo2O3ZmYmLgzMTY2fm96uuIZ5+1GLvTaDbSWQpv6qy5+8tX1nc3wMT2cEARBkhSGYQVOULCqqprIc1jXLcuECyJASs66OVjT2obarqLwH09EW9+UL72lX37blOKmaQSBmZZpmA4cCNCxIT3bsstliy75NRLacx7Vd6Lm9hUXNtT/ub0JlKn+SCqdymQYKkGlqRTLcwIEKAgMy1bKVn37uFizZhCtoVHN4LPt274L72q9te+cRgsgBiGDmuu4hmFA1PAml8tVUIHyL9HQ1kvoYBid7KhqA887As/JgSjHc6IgZTIZNsOKsiRJsiCCMue6TsCsUERK1rw5VNN6HrX9Hngean5DvLgOPBtiDMAQXVOxhlWsKipY1TSsEx0+Hh8fv3v3bhDY41BBvrquSyAqSATqJgYhGG5ArexZyhpLomIilCgJGOtQqiorYEEjRJEkjPHk5IMOk6HsB6g62iCwE/OBSRQDMCEskLOIaTnQ3i4Adj13ZmamHBhv4wVUZ8NP/nV0HfXDB9KFavp2TyqVYRgmFksk4klQZlk+naZohoXnRDzG0GzgeQHVhujT3fXbhxv2Jr49pDMZy7I9152bqqCfshCUCwVYs7Oz8+KId7QFVC1dT4WPvpds/VD8KcTFBjiOV1SVBi2GC0DJgp8PGFWaRHLJkqgwMxwMhmHKsqIqWFYVx3ampqYg6kqTQNoLqGqHlncd3hhp3J5u2iNSIzAJMMmiKOka8bIeVO44EJhXGQzB0RdQfXZ7eceBT4eP7Uqd3M+NRARBBEgsy4IydKXn2WD0kTWk5MxqrwYZCI2i55QKKpliTdOCwGAfEM0wLNN1vMVrSHC0j6wQohDKo5VyZaqSfZGHUdEcDXO1eAECqurcnPLYvHJ5qnBaeBiVteQCFD3yYyK0qR1t60OHw1WXNx/vrG0BZTaSVBRMNCJJ4ujY+NKrF9JuELpf7T79evrS5mRrX9NqoW0tufKOnBqY+1iH1TM985i9DSNZ7VqI6KhUesWP81efz/7zYvHWKiL0zwcGtAEVwIEtbtumDUbABiwj25kLzCaISqBC8SU/PnBupX3jhVLvKj4RzmRojmEpCupXc37W9/NLKPM3d0ZPLuPPLBNOv3x9z5HuA42Dn3+PM1zwxygHFgwT/H3+p2xrakcodQjlGpHfWPXzxiPXdpwKFmBvhKZZkRdBGTrU8ZxsNrdI+T+msHjIMfkQjwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"whole-threads\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-1a291.png 148w,\\n/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-2bc4a.png 295w,\\n/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-fb8a0.png 590w,\\n/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-1c2a9.png 614w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h2>Caveats</h2>\\n<p>You might notice that I am skipping some parts (some rows in the above table) in the article, but that is just to avoid confusion. Even with this simple example, Akka’s internal processing is very complicated. So I am only covering pieces to help you understand important stuff.</p>\\n<h2>Thread[2]- sender side</h2>\\n<div>\\n          <div\\n            class=\\\"gatsby-resp-iframe-wrapper\\\"\\n            style=\\\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem\\\"\\n          >\\n            <iframe src=\\\"https://www.youtube.com/embed/mPmApp5B8s4\\\" frameborder=\\\"0\\\" allow=\\\"autoplay; encrypted-media\\\" allowfullscreen style=\\\"\\n            position: absolute;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n          \\\"></iframe>\\n          </div>\\n          </div>\\n<p>Firstly, let’s look at “Thread[2]” from the output table. As far as what’s explained this article, Thread[2] is pretty the sender side. </p>\\n<p>The sender <code>Actor</code>’s <code>Mailbox</code> was <code>run()</code>, </p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread2-a-8d985489252cb6d3290c795e05ff2f0a-01aca.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 589px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 7.130730050933787%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAANklEQVQI12PYeOfkzpNbT22b+fD8lssn118/Nf/biz0fnm6/d+fqjx8/geDb9+9/sIGfv34BAAYyNZzOaR0vAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread2-a\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread2-a-8d985489252cb6d3290c795e05ff2f0a-01aca.png\\\"\\n        srcset=\\\"/blog/static/thread2-a-8d985489252cb6d3290c795e05ff2f0a-8837c.png 148w,\\n/blog/static/thread2-a-8d985489252cb6d3290c795e05ff2f0a-15c1b.png 295w,\\n/blog/static/thread2-a-8d985489252cb6d3290c795e05ff2f0a-01aca.png 589w\\\"\\n        sizes=\\\"(max-width: 589px) 100vw, 589px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>triggerring <a href=\\\"https://github.com/richardimaoka/resources/blob/master/local-minimal/src/main/scala/example/Main.scala#L15L20\\\"><code>MessageSender</code></a>’s <code>preStart()</code> method:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code><span class=\\\"token keyword\\\">class</span> MessageSender<span class=\\\"token punctuation\\\">(</span>messageReceiver<span class=\\\"token operator\\\">:</span> ActorRef<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">override</span> <span class=\\\"token keyword\\\">def</span> preStart<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">Unit</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">val</span> messages <span class=\\\"token operator\\\">=</span> List<span class=\\\"token punctuation\\\">(</span>\\n      <span class=\\\"token string\\\">\\\"Hello World\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token string\\\">\\\"Hello Universe\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token string\\\">\\\"Hello Galaxy\\\"</span>\\n    <span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">for</span><span class=\\\"token punctuation\\\">(</span>msg <span class=\\\"token keyword\\\">&lt;-</span> messages<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      println<span class=\\\"token punctuation\\\">(</span>s<span class=\\\"token string\\\">\\\"[${Thread.currentThread().getName}]|sending message $msg to $messageReceiver\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n      messageReceiver <span class=\\\"token operator\\\">!</span> msg\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>The very first message, <code>\\\"Hello World\\\"</code> was <code>dispatch</code>-ed (sent) as follows:</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-1c156.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 10.144927536231883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAdklEQVQI12O4/+75490FjzsY3k9g+DhL7Mxsn3urAh6sDnz69OnzZ0Di6ZMnT0DE4yfPnz17CoQvXvyFAYZ7b4GaC8/XMLzpY3jRo7U4vXVb8bQDlfOuXrl88dLFy5evXrt69fKlS7fv3L1z+xZQ4Nfv3/9gAACK4F3sbbepWgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread2-b\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-1a291.png 148w,\\n/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-2bc4a.png 295w,\\n/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-fb8a0.png 590w,\\n/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-1c156.png 621w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>and as in the <a href=\\\"../dispatcher-behavior\\\">previous article</a> the <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatcher.scala#L52L56\\\"><code>dispatch</code></a> method is implemented as below, which puts the message to the message queue of the mailbox, and …</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code><span class=\\\"token keyword\\\">def</span> dispatch<span class=\\\"token punctuation\\\">(</span>\\n  receiver<span class=\\\"token operator\\\">:</span> ActorCell<span class=\\\"token punctuation\\\">,</span>\\n  invocation<span class=\\\"token operator\\\">:</span> Envelope\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">Unit</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">val</span> mbox <span class=\\\"token operator\\\">=</span> receiver<span class=\\\"token punctuation\\\">.</span>mailbox\\n  mbox<span class=\\\"token punctuation\\\">.</span>enqueue<span class=\\\"token punctuation\\\">(</span>receiver<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">,</span> invocation<span class=\\\"token punctuation\\\">)</span>\\n  registerForExecution<span class=\\\"token punctuation\\\">(</span>mbox<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>… then <code>registerForExecution</code> scheduled <code>mbox</code> (= an instance of <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Mailbox.scala#L56L57\\\"><code>Mailbox</code></a> which extends <a href=\\\"https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinTask.html\\\"><code>ForkJoinTask</code></a>) to be executed on a different thread. </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code><span class=\\\"token keyword\\\">abstract</span> <span class=\\\"token keyword\\\">class</span> Mailbox<span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">val</span> messageQueue<span class=\\\"token operator\\\">:</span> MessageQueue<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">extends</span> ForkJoinTask<span class=\\\"token punctuation\\\">[</span><span class=\\\"token builtin\\\">Unit</span><span class=\\\"token punctuation\\\">]</span>\\n  <span class=\\\"token keyword\\\">with</span> SystemMessageQueue \\n  <span class=\\\"token keyword\\\">with</span> Runnable <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>Same as the first message, the second ard thrid messages, <code>\\\"Hellow Universe\\\"</code> and <code>\\\"Hello Galaxy\\\"</code> were <code>dispatch</code>-ed as well. </p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-ef06d.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 19.87075928917609%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA6ElEQVQI1zXOsUvDQBTH8be7+m856B9hR7sJorhIoYoIdrKLCOLiUkFwqqWDIpjYO5Nc7iRFTN57d5ZklKZDiknRL/zGx+fBdIbpaJ+6MDuFsr/2erFhbja/breyaIiIXI8IM8Qs/baOLROis25RLqqqgg+X1sfyAOwJ/PTWr7aPBjvn471L8fg8efPCKPZ938RxZHQYBsYkQor5vFyuAmGTz9Eud6E4a2Sv/yezHhNRLRGzc44yzPPc1p8wF0VerYJ7/eI9tINDoONGvm517tq9Rh4+vcuJUloKqZUKYxVESiudTJPlf7+LhLjL6bH7YwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread2-c\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-1a291.png 148w,\\n/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-2bc4a.png 295w,\\n/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-fb8a0.png 590w,\\n/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-ef06d.png 619w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>Since the <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatcher.scala#L115\\\"><code>registerForExecution(mbox, ...)</code></a> is called for the same <code>Mailbox</code> instance, <code>mbox</code>, the underlying <code>executorService</code> scheduled the same <code>Mailbox</code> (<code>ForkJoinTask</code>).</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>def registerForExecution(mbox: Mailbox, ...): Boolean = {\\n  ...\\n  executorService execute mbox\\n  ...\\n}</code></pre>\\n      </div>\\n<p>About the general behavior when you <code>execute</code> the same <code>ForkJoinTask</code> instance in <code>ForkJoinPool</code>, see my below tweet (not every single <code>ForkJoinTask</code> is really run):</p>\\n<blockquote class=\\\"twitter-tweet\\\"><p lang=\\\"en\\\" dir=\\\"ltr\\\">Ah I see this is how ForkJoinPool&#39;s execute method behaves differently when different Runnable instances are executed, and when the same Runnable instance is executed multiple times. <a href=\\\"https://t.co/OhuHMUyszU\\\">pic.twitter.com/OhuHMUyszU</a></p>&mdash; Richard Imaoka (@richardimaoka) <a href=\\\"https://twitter.com/richardimaoka/status/967260911785226245?ref_src=twsrc%5Etfw\\\">2018/2/23</a></blockquote>\\n<h2>Thread[4]- receiver side</h2>\\n<div>\\n          <div\\n            class=\\\"gatsby-resp-iframe-wrapper\\\"\\n            style=\\\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem\\\"\\n          >\\n            <iframe src=\\\"https://www.youtube.com/embed/91naDxLuveY\\\" frameborder=\\\"0\\\" allow=\\\"autoplay; encrypted-media\\\" allowfullscreen style=\\\"\\n            position: absolute;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n          \\\"></iframe>\\n          </div>\\n          </div>\\n<p>Let’s move onto the “Thread[4]”, the receiver side behavior. The point here (and for the whole article) is that <code>processMailbox()</code> is a <strong>recursive method</strong>.</p>\\n<p>The scheduled <code>ForkJoinTask</code> triggered the <code>run</code> method. Remenber <code>Mailbox extends ForkJoinTask</code>, so <code>Mailbox</code> overrides the <code>run</code> method.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-aa5e8.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 7.3836276083467105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAANklEQVQI12NYcnrnosu7pl5asfb1kWW3Dl46cubNvafPbz98+OjRz9+/gOjHr58QBhr68uMbAAHBNYg9dP7/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread4-a\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-1a291.png 148w,\\n/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-2bc4a.png 295w,\\n/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-fb8a0.png 590w,\\n/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-aa5e8.png 623w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>It’s also discussed in the <a href=\\\"../dispatcher-behavior\\\">previous article</a>, but <code>processMailbox</code> method executs the <a href=\\\"(https://github.com/richardimaoka/resources/blob/master/local-minimal/src/main/scala/example/Main.scala#L8L11)\\\"><code>receive</code> method</a> of the <code>Actor</code></p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-9eb69.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 10.483870967741936%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAfUlEQVQI12N48O5FyasKhscMDB8Y9G+qbyiYuKts1oGq+Xdu3nkJBrdv3X3x8tVTIHjy9PGTx0+ePgGiZ8+evX3zluHuq6elryoZzjMwvGHQvam6OL1ta9HUg1Xzr166AgS3b9+6fPnq9es3rl29evPmjTt37rx99/YfDAAAJC5ZfAcbZZ4AAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread4-b\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-1a291.png 148w,\\n/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-2bc4a.png 295w,\\n/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-fb8a0.png 590w,\\n/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-9eb69.png 620w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code><span class=\\\"token keyword\\\">class</span> MessageReceiver <span class=\\\"token keyword\\\">extends</span> Actor <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">def</span> receive <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">case</span> s<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">String</span> <span class=\\\"token keyword\\\">=></span>\\n      println<span class=\\\"token punctuation\\\">(</span>s<span class=\\\"token string\\\">\\\"${Thread.currentThread()} [${self.path}]|EchoActor: received message = $s\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>Next, you see <code>processMailbox()</code> was called multiple times before you see <code>Mailbox run() finished</code>.\\n\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-02b2c.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 20.421393841166935%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA10lEQVQI11XOvWrCUAAF4PMgtVN9Ng0YqIOLuzhLHTq1FPoARSc3dVNQ9N4bk5AEzf2PNZTuVbxqF89ytvMdpHvpFQ1w4AfV/PHruTdqvY7bb/GcSimttbvtjudCG6uE5IJroznnSilrLJJCeIWPBXDAU/7wUesMmi+T9juZzgmlURyTteuAUepWoihijBzK8nQNsm/llQ0I4PdOzpah1trJggsllZMLYx1rjJFS/Muh2nraxwrYO7nyWe8Om30nryczxoIkSQkhjG6cmaVZEFwuHI9/N/kM1SewqZjv7FwAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread4-c\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-1a291.png 148w,\\n/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-2bc4a.png 295w,\\n/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-fb8a0.png 590w,\\n/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-02b2c.png 617w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>because <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Mailbox.scala#L250\\\"><code>processMailbox</code> method</a> is actually recursive:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code><span class=\\\"token annotation punctuation\\\">@tailrec</span> <span class=\\\"token keyword\\\">private</span> <span class=\\\"token keyword\\\">final</span> <span class=\\\"token keyword\\\">def</span> processMailbox<span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token comment\\\">// def dequeue(): Envelope = messageQueue.dequeue()</span>\\n  <span class=\\\"token keyword\\\">val</span> next <span class=\\\"token operator\\\">=</span> dequeue<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> \\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  actor invoke next\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  processMailbox<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>so it processed all the three messages, <code>\\\"Hello World\\\"</code>, <code>\\\"Hello Universe\\\"</code> and <code>\\\"Hello Galaxy\\\"</code> in the single call of <code>ForkJoinTask</code>’s <code>run</code>.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-ef06d.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 23.909531502423263%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+0lEQVQY013OS0vDQBSG4bNpf2tBvBUDpv0BbkS8bnXjRqv1vlOsuCq0NGl12s6MJplLMpMKGkeQiIiTZfutzubhPVBhdZAAKZTz0tXyzk1176F24DdbUcB0qqUQlAZap4xzrbWIpVIJF1wIoRIFjnahB9ZbfFhZO55bt7hzdNtpdxF69npeuziQ7/uxVn/Tg5W31aI8gfJ36XJp+7q626rtDy4eWcQTlUghw5DJWNoXjPn6nR44ygUKkBTlk/mN88UtW+427oZPozAKKSH9PiIvFGP8/pHNlp2JCyOAuMD257OFTYu903s0GAavARnjMSbGmM8sy/OfGfwPB/fg/chRcOgAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread4-d\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-1a291.png 148w,\\n/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-2bc4a.png 295w,\\n/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-fb8a0.png 590w,\\n/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-ef06d.png 619w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>How many messages can be processed by a single <code>ForkJoinTask</code> is controlled by the <code>throughput</code> setting in <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/resources/reference.conf#L513\\\">config</a>.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code># Throughput defines the number of messages that are processed in a batch\\n# before the thread is returned to the pool. Set to 1 for as fair as possible.\\nthroughput = 5</code></pre>\\n      </div>\\n<h2>Instruction to run the example, and output</h2>\\n<p>We can use <a href=\\\"https://github.com/richardimaoka/resources/tree/master/local-minimal\\\">the same example code</a> as the ”<a href=\\\"../local-minimal-sender\\\">Local Actor workflow part 1 - Sender side</a>” article.code, however, because you need a bit of tweaking which I am going to explain below.</p>\\n<p>Clone the akka repository,</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>> git clone https://github.com/akka/akka.git\\n> cd akka</code></pre>\\n      </div>\\n<p>and insert <code>println</code> calls <a href=\\\"https://github.com/richardimaoka/akka/commit/6b19cabf3d9895fd8cc925b760f6b9ec21a1eaef\\\">like this</a>) in akka to see the <code>Mailbox</code> and <code>Dispatcher</code> behavior. Then execute <code>publishLocal</code>,</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>> sbt\\n> project akka-actor\\n> publishLocal</code></pre>\\n      </div>\\n<p>now you will see <code>akka-actor_2.12;2.5-SNAPSHOT</code> is built and stored under your <code>.ivy</code> directory.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>[info] :: delivering :: com.typesafe.akka#akka-actor_2.12;2.5-SNAPSHOT :: 2.5-SNAPSHOT :: integration :: Thu Feb 22 07:22:33 JST 2018\\n[info] delivering ivy file to Users/username/akka/akka-actor/target/ivy-2.5-SNAPSHOT.xml\\n[info]  published akka-actor_2.12 to Users/username/.ivy2/local/com.typesafe.akka/akka-actor_2.12/2.5-SNAPSHOT/poms/akka-actor_2.12.pom\\n[info]  published akka-actor_2.12 to Users/username/.ivy2/local/com.typesafe.akka/akka-actor_2.12/2.5-SNAPSHOT/jars/akka-actor_2.12.jar\\n[info]  published akka-actor_2.12 to Users/username/.ivy2/local/com.typesafe.akka/akka-actor_2.12/2.5-SNAPSHOT/srcs/akka-actor_2.12-sources.jar\\n[info]  published akka-actor_2.12 to Users/username/.ivy2/local/com.typesafe.akka/akka-actor_2.12/2.5-SNAPSHOT/docs/akka-actor_2.12-javadoc.jar\\n[info]  published ivy to Users/username/.ivy2/local/com.typesafe.akka/akka-actor_2.12/2.5-SNAPSHOT/ivys/ivy.xml</code></pre>\\n      </div>\\n<p>From here you move to the <a href=\\\"https://github.com/richardimaoka/resources/tree/master/local-minimal\\\">local actor example code</a>. </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>> cd ~\\n// or `cd` to whatever directory you like\\n\\n> git clone https://github.com/richardimaoka/resources.git\\n> cd resources\\n> cd local-minimal</code></pre>\\n      </div>\\n<p>Make <a href=\\\"https://github.com/richardimaoka/resources/commit/15e140cb110e8ca37934eb150da94fea49e3431c\\\">this change</a> to the local example code, to use the 2.5-SNAPSHOT version of <code>akka-actor</code> jar built by the above step.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>//build.sbt\\n libraryDependencies ++= Seq(\\n-  \\\"com.typesafe.akka\\\" %% \\\"akka-actor\\\" % \\\"2.5.9\\\",\\n+  \\\"com.typesafe.akka\\\" %% \\\"akka-actor\\\" % \\\"2.5-SNAPSHOT\\\",\\n   scalaTest % Test\\n )</code></pre>\\n      </div>\\n<p>From inside the <code>local-minimal</code> directory, you can do:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>> sbt\\n> runMain example.Main</code></pre>\\n      </div>\\n<p>and you will output like the following (order of messages could be little differnt due to concurrency). </p>\\n<p>After I did some clean-up, I posted the result <a href=\\\"https://drive.google.com/open?id=194-t1rYNQU2mprybSC9RibJ7HopCAdPqJX94XlIKxXk\\\">here in Google Spreadsheet</a>. (Shortened the thread name, exclude <a href=\\\"https://doc.akka.io/docs/akka/2.5/general/supervision.html#user-the-guardian-actor\\\">user guardian</a> from logs, shortened the actor path, etc)</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>Thread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() next=null\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|sending message Hello World to Actor[akka://exampleSystem/user/receiver#1486562265]\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello World,Actor[akka://exampleSystem/user/sender#-1400752577])) started\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello World,Actor[akka://exampleSystem/user/sender#-1400752577])) finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() called, shouldProcessMessage=true\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|sending message Hello Universe to Actor[akka://exampleSystem/user/receiver#1486562265]\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() next=Envelope(Hello World,Actor[akka://exampleSystem/user/sender#-1400752577])\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello Universe,Actor[akka://exampleSystem/user/sender#-1400752577])) started\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|EchoActor: received message = Hello World\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello Universe,Actor[akka://exampleSystem/user/sender#-1400752577])) finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() called, shouldProcessMessage=true\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|sending message Hello Galaxy to Actor[akka://exampleSystem/user/receiver#1486562265]\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() next=Envelope(Hello Universe,Actor[akka://exampleSystem/user/sender#-1400752577])\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello Galaxy,Actor[akka://exampleSystem/user/sender#-1400752577])) started\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|EchoActor: received message = Hello Universe\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello Galaxy,Actor[akka://exampleSystem/user/sender#-1400752577])) finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() called, shouldProcessMessage=true\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox processMailbox() called, shouldProcessMessage=true\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() next=Envelope(Hello Galaxy,Actor[akka://exampleSystem/user/sender#-1400752577])\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox processMailbox() next=null\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|EchoActor: received message = Hello Galaxy\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() called, shouldProcessMessage=true\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() next=null\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() called, shouldProcessMessage=false\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox processMailbox() called, shouldProcessMessage=false\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() called, shouldProcessMessage=false\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() called, shouldProcessMessage=false\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() finished</code></pre>\\n      </div>\\n<h2>References</h2>\\n<ul>\\n<li>Official documentation of Akka Mailbox at <a href=\\\"https://doc.akka.io/docs/akka/current/mailboxes.html\\\">https://doc.akka.io/docs/akka/current/mailboxes.html</a></li>\\n<li>Official documentation of Akka Dispatcher at <a href=\\\"https://doc.akka.io/docs/akka/2.5/dispatchers.html\\\">https://doc.akka.io/docs/akka/2.5/dispatchers.html</a>\\nOracle’s official fork-join tutorial - <a href=\\\"https://docs.oracle.com/javase/tutorial/essential/concurrency/forkjoin.html\\\">https://docs.oracle.com/javase/tutorial/essential/concurrency/forkjoin.html</a>\\nOracle’s official fork-join article - <a href=\\\"http://www.oracle.com/technetwork/articles/java/fork-join-422606.html\\\">http://www.oracle.com/technetwork/articles/java/fork-join-422606.html</a>\\nForkJoinTask javadoc - <a href=\\\"https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinTask.html\\\">https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinTask.html</a>\\nForkJoinPool javadoc - <a href=\\\"https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinPool.html\\\">https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinPool.html</a></li>\\n</ul>\",\"frontmatter\":{\"title\":\"Mailbox and ForkJoinTask\",\"date\":\"February 24, 2018\"}}},\"pathContext\":{\"slug\":\"/mailbox-and-fork-join-task/\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---mailbox-and-fork-join-task-094cf273eb56c5754097.js","module.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Akka, Concurrency, etc.\",\"author\":\"Richard Imaoka\"}},\"markdownRemark\":{\"id\":\"C:/Users/nishyu/blog/src/pages/mailbox-and-fork-join-task/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<h2>Update to the article and the video</h2>\\n<p>Thanks to Victor who immediately noticed I had wrong assumption about <code>ForkJoinTask</code> behavior in akka, now this article and videos were corrected.</p>\\n<blockquote class=\\\"twitter-tweet\\\" data-lang=\\\"ja\\\"><p lang=\\\"en\\\" dir=\\\"ltr\\\">Only one FJT should be created.</p>&mdash; ⎷ (@viktorklang) <a href=\\\"https://twitter.com/viktorklang/status/967066161899819008?ref_src=twsrc%5Etfw\\\">2018年2月23日</a></blockquote>\\n<blockquote class=\\\"twitter-tweet\\\" data-lang=\\\"ja\\\"><p lang=\\\"en\\\" dir=\\\"ltr\\\">No worries! Actually, many years ago it did create many FJT (..or rather, Runnables).</p>&mdash; ⎷ (@viktorklang) <a href=\\\"https://twitter.com/viktorklang/status/967082002804609024?ref_src=twsrc%5Etfw\\\">2018年2月23日</a></blockquote>\\n<h2>Overview</h2>\\n<div>\\n          <div\\n            class=\\\"gatsby-resp-iframe-wrapper\\\"\\n            style=\\\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem\\\"\\n          >\\n            <iframe src=\\\"https://www.youtube.com/embed/dnu6JqtzNJI\\\" frameborder=\\\"0\\\" allow=\\\"autoplay; encrypted-media\\\" allowfullscreen style=\\\"\\n            position: absolute;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n          \\\"></iframe>\\n          </div>\\n          </div>\\n<p>The previous <a href=\\\"../dispatcher-behavior/\\\">Dispatcher behavior</a> article explained how <code>Dispatcher</code> and threads are related to each other. In this article, we will go one step further in this regard.</p>\\n<p>The code example is at <a href=\\\"https://github.com/richardimaoka/resources/tree/master/local-minimal\\\">GitHub</a>, which is the same example as\\nwhat’s discussed in <a href=\\\"http://localhost:8000/local-minimal-sender/\\\">the local actor article(s)</a>.</p>\\n<h2>Thread-processing details in Akka</h2>\\n<p>Following the instruction at the bottom of this article, you will get output as follows <a href=\\\"https://drive.google.com/open?id=194-t1rYNQU2mprybSC9RibJ7HopCAdPqJX94XlIKxXk\\\">(also in GoogleSpreadsheet)</a> . </p>\\n<p><strong>SO MANY things in the table!! but no worries!</strong> We will go through each important piece, one after another.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-1c2a9.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 147.557003257329%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAE5ElEQVQ4y3WV228UZRjGv7/B6AUYL6hXmJgo6rVXYiQx4CF6IRfWdAUF5FQgHBuVghasiKWlgmCIFhQktYJ1Kbb0zG53d/Yw59M38815d/bQlrbQFuM77dKFWr5MJplJJs/7PL/3fQcxpnKNjV6Wor/xtztx2r1TsEq57GTJGc/D/eHLGVv8BvXoqUj3qZ6W9W7Xbnxj91D7llG+ocQfoal+1/Xyvu9Y1szs/X+XOkgruLUms4LtW2GmVtPDnXu/6KlrGPryhEaztm27jmMQwzQs27E9L3v/0YPUvH02fjF0ZevW3rqvb9V1Hl4fa/qYO7OZjw/xvCCLEstxhBDf90dHS4VCoVgsTk5NlZVx3pHDNfFjSG1GpOWZ6/t399fXjTTUS0lKVRVN0xVFIVgjoG5Z8CZfKNybvldW1oruCTr0bhd6P4a29VZd2fLN37Wne/ed50fSGGsmMVRZLo2O3ZmYmLgzMTY2fm96uuIZ5+1GLvTaDbSWQpv6qy5+8tX1nc3wMT2cEARBkhSGYQVOULCqqprIc1jXLcuECyJASs66OVjT2obarqLwH09EW9+UL72lX37blOKmaQSBmZZpmA4cCNCxIT3bsstliy75NRLacx7Vd6Lm9hUXNtT/ub0JlKn+SCqdymQYKkGlqRTLcwIEKAgMy1bKVn37uFizZhCtoVHN4LPt274L72q9te+cRgsgBiGDmuu4hmFA1PAml8tVUIHyL9HQ1kvoYBid7KhqA887As/JgSjHc6IgZTIZNsOKsiRJsiCCMue6TsCsUERK1rw5VNN6HrX9Hngean5DvLgOPBtiDMAQXVOxhlWsKipY1TSsEx0+Hh8fv3v3bhDY41BBvrquSyAqSATqJgYhGG5ArexZyhpLomIilCgJGOtQqiorYEEjRJEkjPHk5IMOk6HsB6g62iCwE/OBSRQDMCEskLOIaTnQ3i4Adj13ZmamHBhv4wVUZ8NP/nV0HfXDB9KFavp2TyqVYRgmFksk4klQZlk+naZohoXnRDzG0GzgeQHVhujT3fXbhxv2Jr49pDMZy7I9152bqqCfshCUCwVYs7Oz8+KId7QFVC1dT4WPvpds/VD8KcTFBjiOV1SVBi2GC0DJgp8PGFWaRHLJkqgwMxwMhmHKsqIqWFYVx3ampqYg6kqTQNoLqGqHlncd3hhp3J5u2iNSIzAJMMmiKOka8bIeVO44EJhXGQzB0RdQfXZ7eceBT4eP7Uqd3M+NRARBBEgsy4IydKXn2WD0kTWk5MxqrwYZCI2i55QKKpliTdOCwGAfEM0wLNN1vMVrSHC0j6wQohDKo5VyZaqSfZGHUdEcDXO1eAECqurcnPLYvHJ5qnBaeBiVteQCFD3yYyK0qR1t60OHw1WXNx/vrG0BZTaSVBRMNCJJ4ujY+NKrF9JuELpf7T79evrS5mRrX9NqoW0tufKOnBqY+1iH1TM985i9DSNZ7VqI6KhUesWP81efz/7zYvHWKiL0zwcGtAEVwIEtbtumDUbABiwj25kLzCaISqBC8SU/PnBupX3jhVLvKj4RzmRojmEpCupXc37W9/NLKPM3d0ZPLuPPLBNOv3x9z5HuA42Dn3+PM1zwxygHFgwT/H3+p2xrakcodQjlGpHfWPXzxiPXdpwKFmBvhKZZkRdBGTrU8ZxsNrdI+T+msHjIMfkQjwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"whole-threads\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-1a291.png 148w,\\n/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-2bc4a.png 295w,\\n/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-fb8a0.png 590w,\\n/blog/static/whole-threads-066b39612b4321a93f47380f6f47c120-1c2a9.png 614w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h2>Caveats</h2>\\n<p>You might notice that I am skipping some parts (some rows in the above table) in the article, but that is just to avoid confusion. Even with this simple example, Akka’s internal processing is very complicated. So I am only covering pieces to help you understand important stuff.</p>\\n<h2>Thread[2]- sender side</h2>\\n<div>\\n          <div\\n            class=\\\"gatsby-resp-iframe-wrapper\\\"\\n            style=\\\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem\\\"\\n          >\\n            <iframe src=\\\"https://www.youtube.com/embed/mPmApp5B8s4\\\" frameborder=\\\"0\\\" allow=\\\"autoplay; encrypted-media\\\" allowfullscreen style=\\\"\\n            position: absolute;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n          \\\"></iframe>\\n          </div>\\n          </div>\\n<p>Firstly, let’s look at “Thread[2]” from the output table. As far as what’s explained this article, Thread[2] is pretty the sender side. </p>\\n<p>The sender <code>Actor</code>’s <code>Mailbox</code> was <code>run()</code>, </p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread2-a-8d985489252cb6d3290c795e05ff2f0a-01aca.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 589px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 7.130730050933787%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAANklEQVQI12PYeOfkzpNbT22b+fD8lssn118/Nf/biz0fnm6/d+fqjx8/geDb9+9/sIGfv34BAAYyNZzOaR0vAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread2-a\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread2-a-8d985489252cb6d3290c795e05ff2f0a-01aca.png\\\"\\n        srcset=\\\"/blog/static/thread2-a-8d985489252cb6d3290c795e05ff2f0a-8837c.png 148w,\\n/blog/static/thread2-a-8d985489252cb6d3290c795e05ff2f0a-15c1b.png 295w,\\n/blog/static/thread2-a-8d985489252cb6d3290c795e05ff2f0a-01aca.png 589w\\\"\\n        sizes=\\\"(max-width: 589px) 100vw, 589px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>triggerring <a href=\\\"https://github.com/richardimaoka/resources/blob/master/local-minimal/src/main/scala/example/Main.scala#L15L20\\\"><code>MessageSender</code></a>’s <code>preStart()</code> method:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code><span class=\\\"token keyword\\\">class</span> MessageSender<span class=\\\"token punctuation\\\">(</span>messageReceiver<span class=\\\"token operator\\\">:</span> ActorRef<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">override</span> <span class=\\\"token keyword\\\">def</span> preStart<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">Unit</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">val</span> messages <span class=\\\"token operator\\\">=</span> List<span class=\\\"token punctuation\\\">(</span>\\n      <span class=\\\"token string\\\">\\\"Hello World\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token string\\\">\\\"Hello Universe\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token string\\\">\\\"Hello Galaxy\\\"</span>\\n    <span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">for</span><span class=\\\"token punctuation\\\">(</span>msg <span class=\\\"token keyword\\\">&lt;-</span> messages<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      println<span class=\\\"token punctuation\\\">(</span>s<span class=\\\"token string\\\">\\\"[${Thread.currentThread().getName}]|sending message $msg to $messageReceiver\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n      messageReceiver <span class=\\\"token operator\\\">!</span> msg\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>The very first message, <code>\\\"Hello World\\\"</code> was <code>dispatch</code>-ed (sent) as follows:</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-1c156.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 10.144927536231883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAdklEQVQI12O4/+75490FjzsY3k9g+DhL7Mxsn3urAh6sDnz69OnzZ0Di6ZMnT0DE4yfPnz17CoQvXvyFAYZ7b4GaC8/XMLzpY3jRo7U4vXVb8bQDlfOuXrl88dLFy5evXrt69fKlS7fv3L1z+xZQ4Nfv3/9gAACK4F3sbbepWgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread2-b\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-1a291.png 148w,\\n/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-2bc4a.png 295w,\\n/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-fb8a0.png 590w,\\n/blog/static/thread2-b-114a78e2ede459443c8403dbf47add14-1c156.png 621w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>and as in the <a href=\\\"../dispatcher-behavior\\\">previous article</a> the <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatcher.scala#L52L56\\\"><code>dispatch</code></a> method is implemented as below, which puts the message to the message queue of the mailbox, and …</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code><span class=\\\"token keyword\\\">def</span> dispatch<span class=\\\"token punctuation\\\">(</span>\\n  receiver<span class=\\\"token operator\\\">:</span> ActorCell<span class=\\\"token punctuation\\\">,</span>\\n  invocation<span class=\\\"token operator\\\">:</span> Envelope\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">Unit</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">val</span> mbox <span class=\\\"token operator\\\">=</span> receiver<span class=\\\"token punctuation\\\">.</span>mailbox\\n  mbox<span class=\\\"token punctuation\\\">.</span>enqueue<span class=\\\"token punctuation\\\">(</span>receiver<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">,</span> invocation<span class=\\\"token punctuation\\\">)</span>\\n  registerForExecution<span class=\\\"token punctuation\\\">(</span>mbox<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>… then <code>registerForExecution</code> scheduled <code>mbox</code> (= an instance of <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Mailbox.scala#L56L57\\\"><code>Mailbox</code></a> which extends <a href=\\\"https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinTask.html\\\"><code>ForkJoinTask</code></a>) to be executed on a different thread. </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code><span class=\\\"token keyword\\\">abstract</span> <span class=\\\"token keyword\\\">class</span> Mailbox<span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">val</span> messageQueue<span class=\\\"token operator\\\">:</span> MessageQueue<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">extends</span> ForkJoinTask<span class=\\\"token punctuation\\\">[</span><span class=\\\"token builtin\\\">Unit</span><span class=\\\"token punctuation\\\">]</span>\\n  <span class=\\\"token keyword\\\">with</span> SystemMessageQueue \\n  <span class=\\\"token keyword\\\">with</span> Runnable <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>Same as the first message, the second ard thrid messages, <code>\\\"Hellow Universe\\\"</code> and <code>\\\"Hello Galaxy\\\"</code> were <code>dispatch</code>-ed as well. </p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-ef06d.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 19.87075928917609%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA6ElEQVQI1zXOsUvDQBTH8be7+m856B9hR7sJorhIoYoIdrKLCOLiUkFwqqWDIpjYO5Nc7iRFTN57d5ZklKZDiknRL/zGx+fBdIbpaJ+6MDuFsr/2erFhbja/breyaIiIXI8IM8Qs/baOLROis25RLqqqgg+X1sfyAOwJ/PTWr7aPBjvn471L8fg8efPCKPZ938RxZHQYBsYkQor5vFyuAmGTz9Eud6E4a2Sv/yezHhNRLRGzc44yzPPc1p8wF0VerYJ7/eI9tINDoONGvm517tq9Rh4+vcuJUloKqZUKYxVESiudTJPlf7+LhLjL6bH7YwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread2-c\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-1a291.png 148w,\\n/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-2bc4a.png 295w,\\n/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-fb8a0.png 590w,\\n/blog/static/thread2-c-99271c77c10ff7f19b21c01ad4dae08a-ef06d.png 619w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>Since the <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Dispatcher.scala#L115\\\"><code>registerForExecution(mbox, ...)</code></a> is called for the same <code>Mailbox</code> instance, <code>mbox</code>, the underlying <code>executorService</code> scheduled the same <code>Mailbox</code> (<code>ForkJoinTask</code>).</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>def registerForExecution(mbox: Mailbox, ...): Boolean = {\\n  ...\\n  executorService execute mbox\\n  ...\\n}</code></pre>\\n      </div>\\n<p>About the general behavior when you <code>execute</code> the same <code>ForkJoinTask</code> instance in <code>ForkJoinPool</code>, see my below tweet (not every single <code>ForkJoinTask</code> is really run):</p>\\n<blockquote class=\\\"twitter-tweet\\\"><p lang=\\\"en\\\" dir=\\\"ltr\\\">Ah I see this is how ForkJoinPool&#39;s execute method behaves differently when different Runnable instances are executed, and when the same Runnable instance is executed multiple times. <a href=\\\"https://t.co/OhuHMUyszU\\\">pic.twitter.com/OhuHMUyszU</a></p>&mdash; Richard Imaoka (@richardimaoka) <a href=\\\"https://twitter.com/richardimaoka/status/967260911785226245?ref_src=twsrc%5Etfw\\\">2018/2/23</a></blockquote>\\n<h2>Thread[4]- receiver side</h2>\\n<div>\\n          <div\\n            class=\\\"gatsby-resp-iframe-wrapper\\\"\\n            style=\\\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem\\\"\\n          >\\n            <iframe src=\\\"https://www.youtube.com/embed/91naDxLuveY\\\" frameborder=\\\"0\\\" allow=\\\"autoplay; encrypted-media\\\" allowfullscreen style=\\\"\\n            position: absolute;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n          \\\"></iframe>\\n          </div>\\n          </div>\\n<p>Let’s move onto the “Thread[4]”, the receiver side behavior. The point here (and for the whole article) is that <code>processMailbox()</code> is a <strong>recursive method</strong>.</p>\\n<p>The scheduled <code>ForkJoinTask</code> triggered the <code>run</code> method. Remenber <code>Mailbox extends ForkJoinTask</code>, so <code>Mailbox</code> overrides the <code>run</code> method.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-aa5e8.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 7.3836276083467105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAANklEQVQI12NYcnrnosu7pl5asfb1kWW3Dl46cubNvafPbz98+OjRz9+/gOjHr58QBhr68uMbAAHBNYg9dP7/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread4-a\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-1a291.png 148w,\\n/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-2bc4a.png 295w,\\n/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-fb8a0.png 590w,\\n/blog/static/thread4-a-9e49aae18351df1e05777b6435f0512a-aa5e8.png 623w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>It’s also discussed in the <a href=\\\"../dispatcher-behavior\\\">previous article</a>, but <code>processMailbox</code> method executs the <a href=\\\"(https://github.com/richardimaoka/resources/blob/master/local-minimal/src/main/scala/example/Main.scala#L8L11)\\\"><code>receive</code> method</a> of the <code>Actor</code></p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-9eb69.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 10.483870967741936%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAfUlEQVQI12N48O5FyasKhscMDB8Y9G+qbyiYuKts1oGq+Xdu3nkJBrdv3X3x8tVTIHjy9PGTx0+ePgGiZ8+evX3zluHuq6elryoZzjMwvGHQvam6OL1ta9HUg1Xzr166AgS3b9+6fPnq9es3rl29evPmjTt37rx99/YfDAAAJC5ZfAcbZZ4AAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread4-b\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-1a291.png 148w,\\n/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-2bc4a.png 295w,\\n/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-fb8a0.png 590w,\\n/blog/static/thread4-b-6d1b838c9c19c60825f7c99260c0d880-9eb69.png 620w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code><span class=\\\"token keyword\\\">class</span> MessageReceiver <span class=\\\"token keyword\\\">extends</span> Actor <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">def</span> receive <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">case</span> s<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">String</span> <span class=\\\"token keyword\\\">=></span>\\n      println<span class=\\\"token punctuation\\\">(</span>s<span class=\\\"token string\\\">\\\"${Thread.currentThread()} [${self.path}]|EchoActor: received message = $s\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>Next, you see <code>processMailbox()</code> was called multiple times before you see <code>Mailbox run() finished</code>.\\n\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-02b2c.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 20.421393841166935%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA10lEQVQI11XOvWrCUAAF4PMgtVN9Ng0YqIOLuzhLHTq1FPoARSc3dVNQ9N4bk5AEzf2PNZTuVbxqF89ytvMdpHvpFQ1w4AfV/PHruTdqvY7bb/GcSimttbvtjudCG6uE5IJroznnSilrLJJCeIWPBXDAU/7wUesMmi+T9juZzgmlURyTteuAUepWoihijBzK8nQNsm/llQ0I4PdOzpah1trJggsllZMLYx1rjJFS/Muh2nraxwrYO7nyWe8Om30nryczxoIkSQkhjG6cmaVZEFwuHI9/N/kM1SewqZjv7FwAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread4-c\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-1a291.png 148w,\\n/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-2bc4a.png 295w,\\n/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-fb8a0.png 590w,\\n/blog/static/thread4-c-361a5920b601649cced526ed2f99c923-02b2c.png 617w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>because <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/scala/akka/dispatch/Mailbox.scala#L250\\\"><code>processMailbox</code> method</a> is actually recursive:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-scala\\\"><code><span class=\\\"token annotation punctuation\\\">@tailrec</span> <span class=\\\"token keyword\\\">private</span> <span class=\\\"token keyword\\\">final</span> <span class=\\\"token keyword\\\">def</span> processMailbox<span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  <span class=\\\"token comment\\\">// def dequeue(): Envelope = messageQueue.dequeue()</span>\\n  <span class=\\\"token keyword\\\">val</span> next <span class=\\\"token operator\\\">=</span> dequeue<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> \\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  actor invoke next\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>\\n  processMailbox<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>so it processed all the three messages, <code>\\\"Hello World\\\"</code>, <code>\\\"Hello Universe\\\"</code> and <code>\\\"Hello Galaxy\\\"</code> in the single call of <code>ForkJoinTask</code>’s <code>run</code>.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-ef06d.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 23.909531502423263%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+0lEQVQY013OS0vDQBSG4bNpf2tBvBUDpv0BbkS8bnXjRqv1vlOsuCq0NGl12s6MJplLMpMKGkeQiIiTZfutzubhPVBhdZAAKZTz0tXyzk1176F24DdbUcB0qqUQlAZap4xzrbWIpVIJF1wIoRIFjnahB9ZbfFhZO55bt7hzdNtpdxF69npeuziQ7/uxVn/Tg5W31aI8gfJ36XJp+7q626rtDy4eWcQTlUghw5DJWNoXjPn6nR44ygUKkBTlk/mN88UtW+427oZPozAKKSH9PiIvFGP8/pHNlp2JCyOAuMD257OFTYu903s0GAavARnjMSbGmM8sy/OfGfwPB/fg/chRcOgAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"thread4-d\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-fb8a0.png\\\"\\n        srcset=\\\"/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-1a291.png 148w,\\n/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-2bc4a.png 295w,\\n/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-fb8a0.png 590w,\\n/blog/static/thread4-d-277e3712f0d47a8446f144afc35b9a44-ef06d.png 619w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>How many messages can be processed by a single <code>ForkJoinTask</code> is controlled by the <code>throughput</code> setting in <a href=\\\"https://github.com/akka/akka/blob/v2.5.9/akka-actor/src/main/resources/reference.conf#L513\\\">config</a>.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code># Throughput defines the number of messages that are processed in a batch\\n# before the thread is returned to the pool. Set to 1 for as fair as possible.\\nthroughput = 5</code></pre>\\n      </div>\\n<h2>Instruction to run the example, and output</h2>\\n<p>We can use <a href=\\\"https://github.com/richardimaoka/resources/tree/master/local-minimal\\\">the same example code</a> as the ”<a href=\\\"../local-minimal-sender\\\">Local Actor workflow part 1 - Sender side</a>” article.code, however, because you need a bit of tweaking which I am going to explain below.</p>\\n<p>Clone the akka repository,</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>> git clone https://github.com/akka/akka.git\\n> cd akka</code></pre>\\n      </div>\\n<p>and insert <code>println</code> calls <a href=\\\"https://github.com/richardimaoka/akka/commit/6b19cabf3d9895fd8cc925b760f6b9ec21a1eaef\\\">like this</a>) in akka to see the <code>Mailbox</code> and <code>Dispatcher</code> behavior. Then execute <code>publishLocal</code>,</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>> sbt\\n> project akka-actor\\n> publishLocal</code></pre>\\n      </div>\\n<p>now you will see <code>akka-actor_2.12;2.5-SNAPSHOT</code> is built and stored under your <code>.ivy</code> directory.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>[info] :: delivering :: com.typesafe.akka#akka-actor_2.12;2.5-SNAPSHOT :: 2.5-SNAPSHOT :: integration :: Thu Feb 22 07:22:33 JST 2018\\n[info] delivering ivy file to Users/username/akka/akka-actor/target/ivy-2.5-SNAPSHOT.xml\\n[info]  published akka-actor_2.12 to Users/username/.ivy2/local/com.typesafe.akka/akka-actor_2.12/2.5-SNAPSHOT/poms/akka-actor_2.12.pom\\n[info]  published akka-actor_2.12 to Users/username/.ivy2/local/com.typesafe.akka/akka-actor_2.12/2.5-SNAPSHOT/jars/akka-actor_2.12.jar\\n[info]  published akka-actor_2.12 to Users/username/.ivy2/local/com.typesafe.akka/akka-actor_2.12/2.5-SNAPSHOT/srcs/akka-actor_2.12-sources.jar\\n[info]  published akka-actor_2.12 to Users/username/.ivy2/local/com.typesafe.akka/akka-actor_2.12/2.5-SNAPSHOT/docs/akka-actor_2.12-javadoc.jar\\n[info]  published ivy to Users/username/.ivy2/local/com.typesafe.akka/akka-actor_2.12/2.5-SNAPSHOT/ivys/ivy.xml</code></pre>\\n      </div>\\n<p>From here you move to the <a href=\\\"https://github.com/richardimaoka/resources/tree/master/local-minimal\\\">local actor example code</a>. </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>> cd ~\\n// or `cd` to whatever directory you like\\n\\n> git clone https://github.com/richardimaoka/resources.git\\n> cd resources\\n> cd local-minimal</code></pre>\\n      </div>\\n<p>Make <a href=\\\"https://github.com/richardimaoka/resources/commit/15e140cb110e8ca37934eb150da94fea49e3431c\\\">this change</a> to the local example code, to use the 2.5-SNAPSHOT version of <code>akka-actor</code> jar built by the above step.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>//build.sbt\\n libraryDependencies ++= Seq(\\n-  \\\"com.typesafe.akka\\\" %% \\\"akka-actor\\\" % \\\"2.5.9\\\",\\n+  \\\"com.typesafe.akka\\\" %% \\\"akka-actor\\\" % \\\"2.5-SNAPSHOT\\\",\\n   scalaTest % Test\\n )</code></pre>\\n      </div>\\n<p>From inside the <code>local-minimal</code> directory, you can do:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>> sbt\\n> runMain example.Main</code></pre>\\n      </div>\\n<p>and you will output like the following (order of messages could be little differnt due to concurrency). </p>\\n<p>After I did some clean-up, I posted the result <a href=\\\"https://drive.google.com/open?id=194-t1rYNQU2mprybSC9RibJ7HopCAdPqJX94XlIKxXk\\\">here in Google Spreadsheet</a>. (Shortened the thread name, exclude <a href=\\\"https://doc.akka.io/docs/akka/2.5/general/supervision.html#user-the-guardian-actor\\\">user guardian</a> from logs, shortened the actor path, etc)</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>Thread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() next=null\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|sending message Hello World to Actor[akka://exampleSystem/user/receiver#1486562265]\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello World,Actor[akka://exampleSystem/user/sender#-1400752577])) started\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello World,Actor[akka://exampleSystem/user/sender#-1400752577])) finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() called, shouldProcessMessage=true\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|sending message Hello Universe to Actor[akka://exampleSystem/user/receiver#1486562265]\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() next=Envelope(Hello World,Actor[akka://exampleSystem/user/sender#-1400752577])\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello Universe,Actor[akka://exampleSystem/user/sender#-1400752577])) started\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|EchoActor: received message = Hello World\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello Universe,Actor[akka://exampleSystem/user/sender#-1400752577])) finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() called, shouldProcessMessage=true\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|sending message Hello Galaxy to Actor[akka://exampleSystem/user/receiver#1486562265]\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() next=Envelope(Hello Universe,Actor[akka://exampleSystem/user/sender#-1400752577])\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello Galaxy,Actor[akka://exampleSystem/user/sender#-1400752577])) started\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|EchoActor: received message = Hello Universe\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Dispatcher dispatch(Envelope(Hello Galaxy,Actor[akka://exampleSystem/user/sender#-1400752577])) finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() called, shouldProcessMessage=true\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox processMailbox() called, shouldProcessMessage=true\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() next=Envelope(Hello Galaxy,Actor[akka://exampleSystem/user/sender#-1400752577])\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox processMailbox() next=null\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|EchoActor: received message = Hello Galaxy\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() called, shouldProcessMessage=true\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() next=null\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() called, shouldProcessMessage=false\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox processMailbox() called, shouldProcessMessage=false\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user/sender]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() called, shouldProcessMessage=false\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox processMailbox() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox run() called\\nThread[exampleSystem-akka.actor.default-dispatcher-4,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-2,5,run-main-group-8]|[akka://exampleSystem/user/receiver]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox run() finished\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() called, shouldProcessMessage=false\\nThread[exampleSystem-akka.actor.default-dispatcher-3,5,run-main-group-8]|[akka://exampleSystem/user]|Mailbox processMailbox() finished</code></pre>\\n      </div>\\n<h2>References</h2>\\n<ul>\\n<li>Official documentation of Akka Mailbox at <a href=\\\"https://doc.akka.io/docs/akka/current/mailboxes.html\\\">https://doc.akka.io/docs/akka/current/mailboxes.html</a></li>\\n<li>Official documentation of Akka Dispatcher at <a href=\\\"https://doc.akka.io/docs/akka/2.5/dispatchers.html\\\">https://doc.akka.io/docs/akka/2.5/dispatchers.html</a>\\nOracle’s official fork-join tutorial - <a href=\\\"https://docs.oracle.com/javase/tutorial/essential/concurrency/forkjoin.html\\\">https://docs.oracle.com/javase/tutorial/essential/concurrency/forkjoin.html</a>\\nOracle’s official fork-join article - <a href=\\\"http://www.oracle.com/technetwork/articles/java/fork-join-422606.html\\\">http://www.oracle.com/technetwork/articles/java/fork-join-422606.html</a>\\nForkJoinTask javadoc - <a href=\\\"https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinTask.html\\\">https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinTask.html</a>\\nForkJoinPool javadoc - <a href=\\\"https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinPool.html\\\">https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinPool.html</a></li>\\n</ul>\",\"frontmatter\":{\"title\":\"Mailbox and ForkJoinTask\",\"date\":\"February 24, 2018\"}}},\"pathContext\":{\"slug\":\"/mailbox-and-fork-join-task/\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/mailbox-and-fork-join-task.json\n// module id = 518\n// module chunks = 165329427061039"],"sourceRoot":""}